:root{
  --font: 18px Courier, "Courier New", monospace;
  --lineh: 1.5;
  --page-w: 900;

  /* Light theme */
  --ui: #ffffff; --ui-border: #d0d0d0; --ui-text:#1f1f1f;
  --stage-bg:#ececec; --page-bg-light:#ffffff;

  /* Dark theme (neutral, “black ink” uses page dark) */
  --page-bg-dark:#1c1c1c;
  --page-bg: var(--page-bg-light);

  /* Inks */
  --ink-dark-ref: var(--page-bg-dark);
  --ink-white:#ffffff;

  /* Buttons */
  --btn-bg:#f4f4f4; --btn-fg:#1f1f1f; --btn-border:#c6c6c6;
  --btn-hover:#ededed; --btn-active:#e6e6e6; --focus-ring:#9e9e9e;

  /* Ruler/toolbar */
  --tri-color:#666; --tri-red:#b00000;
  --toolbar-h:48px; --toolbar-border:1px; --tri-h:12px;
  --ruler-bg: rgba(255,255,255,0.4);
  --ruler-tick: rgba(0,0,0,0.5);
}

@media (prefers-color-scheme: dark){
  :root{
    --ui:#1f1f1f; --ui-border:rgba(255,255,255,.08); --ui-text:#e6e6e6;
    --stage-bg:#212121; --page-bg:var(--page-bg-dark); --tri-color:#bdbdbd;
    --btn-bg:#2a2a2a; --btn-fg:#e6e6e6; --btn-border:#3a3a3a;
    --btn-hover:#313131; --btn-active:#3a3a3a; --focus-ring:#bdbdbd;
    --ruler-bg: rgba(0,0,0,0.2);
    --ruler-tick: rgba(255,255,255,0.4);
  }
}
:root[data-theme="dark"]{
  --ui:#1f1f1f; --ui-border:rgba(255,255,255,.08); --ui-text:#e6e6e6;
  --stage-bg:#212121; --page-bg:var(--page-bg-dark); --tri-color:#bdbdbd;
  --btn-bg:#2a2a2a; --btn-fg:#e6e6e6; --btn-border:#3a3a3a;
  --btn-hover:#313131; --btn-active:#3a3a3a; --focus-ring:#bdbdbd;
  --ruler-bg: rgba(0,0,0,0.2);
  --ruler-tick: rgba(255,255,255,0.4);
}
:root[data-theme="light"]{
  --ui:#ffffff; --ui-border:#d0d0d0; --ui-text:#1f1f1f;
  --stage-bg:#ececec; --page-bg:var(--page-bg-light); --tri-color:#666;
  --btn-bg:#f4f4f4; --btn-fg:#1f1f1f; --btn-border:#c6c6c6;
  --btn-hover:#ededed; --btn-active:#e6e6e6; --focus-ring:#9e9e9e;
  --ruler-bg: rgba(255,255,255,0.4);
  --ruler-tick: rgba(0,0,0,0.5);
}

html,body{margin:0;height:100%;background:var(--stage-bg);font:var(--font);color:var(--ui-text)}

.toolbar{
  box-sizing:border-box; position:fixed; left:0; right:0; bottom:0; height:var(--toolbar-h);
  z-index:51; display:flex; gap:.5rem; align-items:center;
  padding:.6rem .8rem; background:var(--ui); color:var(--ui-text);
  border-top:var(--toolbar-border) solid var(--ui-border);
}
.btn{
  box-sizing:border-box; border:1px solid var(--btn-border);
  background:var(--btn-bg); color:var(--btn-fg); padding:.2rem .8rem;
  border-radius:6px; cursor:pointer; display:flex; align-items:center; justify-content:center;
  line-height:1.2rem; font-weight:500;
}
.btn:hover{ background:var(--btn-hover) } .btn:active{ background:var(--btn-active) }
.btn[data-active="true"]{ outline:2px solid var(--focus-ring) }
.doc-title-input {
  box-sizing: border-box;
  background: var(--btn-bg); color: var(--btn-fg); border: 1px solid var(--btn-border);
  border-radius: 6px; padding: .2rem .5rem; font: var(--font); line-height: 1.2rem;
  width: 200px;
}

.sw{display:inline-block;width:1.1rem;height:1.1rem;border:1px solid rgba(0,0,0,.25);border-radius:3px}
@media (prefers-color-scheme: dark){ .sw{border-color:rgba(255,255,255,.25)} }
.sw.black{background:var(--ink-dark-ref)} .sw.red{background:#b00000} .sw.white{background:#fff}

.doc-controls-group { position: relative; display: flex; gap: .5rem; align-items: center; }
.dropdown { position: static; }
.dropdown-content {
  display: none;
  position: absolute;
  background-color: var(--ui);
  left: 0;
  right: 0;
  box-shadow: none;
  z-index: 52;
  bottom: 100%;
  margin-bottom: 5px;
  border: 1px solid var(--ui-border);
  border-radius: 6px;
  max-height: 300px;
  overflow-y: auto;
}
.dropdown-content.show { display: block; }
.dropdown-content button {
  color: var(--btn-fg); padding: 8px 12px; text-decoration: none;
  display: block; width: 100%; text-align: left; background: none; border: none;
  cursor: pointer; font-size: 14px;
}
.dropdown-content button:hover { background-color: var(--btn-hover); }

.ruler{
  position:fixed; left:0; right:0; bottom:var(--toolbar-h); height:16px; z-index:50;
  pointer-events:none; display:block; overflow:hidden;
}
#rulerH_stops_container { position: absolute; inset: 0; pointer-events: auto; }
.ruler-ticks{
  position:absolute; inset:0; background:var(--ruler-bg);
  border-top:1px solid var(--ruler-tick); box-sizing:border-box;
}
.tick{ position:absolute; bottom:0; width:1px; background:var(--ruler-tick); }
.tick.major{ height:100%; }
.tick.medium{ height:60%; }
.tick.minor{ height:30%; }
.tick-num{
  position:absolute; top:0; font-size:9px; line-height:9px;
  color:var(--ruler-tick); font-family:sans-serif; opacity:0.8;
}

.tri{
  position:absolute; bottom:0; width:0; height:0; cursor:ew-resize;
  border-left:8px solid transparent; border-right:8px solid transparent;
  border-bottom:var(--tri-h) solid var(--tri-color); transform:translateX(-50%);
  filter:drop-shadow(0 0 1px #0004); z-index:2;
}
.tri.right{border-bottom-color:#b00000}

.ruler-v{
  position:fixed; left:0; top:0; bottom:0; width:16px; z-index:50;
  pointer-events:none; display:block; overflow:hidden;
}
#rulerV_stops_container { position: absolute; inset: 0; pointer-events: auto; }
.ruler-v-ticks{
  position:absolute; inset:0; background:var(--ruler-bg);
  border-right:1px solid var(--ruler-tick); box-sizing:border-box;
}
.tick-v{ position:absolute; right:0; height:1px; background:var(--ruler-tick); }
.tick-v.major{ width:100%; }
.tick-v.medium{ width:60%; }
.tick-v.minor{ width:30%; }
.tick-v-num{
  position:absolute; left:2px; font-size:9px; line-height:9px;
  color:var(--ruler-tick); font-family:sans-serif; opacity:0.8;
}

.tri-v{
  position:absolute; left:0; width:0; height:0; cursor:ns-resize;
  border-top:8px solid transparent; border-bottom:8px solid transparent;
  border-left:var(--tri-h) solid var(--tri-color); transform:translateY(-50%);
  filter:drop-shadow(0 0 1px #0004); z-index:2;
}
.tri-v.bottom{border-left-color:#b00000}
.inactive-stop { opacity: 0.4; pointer-events: none; }

.stage{ height:100vh; overflow:auto; background:var(--stage-bg); position:relative; }
.stage-inner{ width:300vw; padding-top: 40vh; padding-bottom: 60vh; box-sizing:border-box; }
.page-wrap{
  width:calc(var(--page-w) * 1px); margin:0 auto 16px; position:relative;
}
canvas{display:block; background:transparent}

#shim{
  position:fixed; left:0; top:0; width:1px; height:1px; opacity:0; color:transparent;
  background:transparent; border:0; resize:none; pointer-events:none; z-index:0;
}

.guide{
  position: fixed; display: none; pointer-events: none;
  z-index: 100;
}
#guideH{
  left: 0; right: 0; height: 0;
  border-top: 1px dashed var(--tri-color);
}
#guideV{
  top: 0; bottom: 0; width: 0;
  border-left: 1px dashed var(--tri-color);
}

.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 100;
  justify-content: center;
  align-items: center;
}
.modal-overlay.show {
  display: flex;
}
.modal-content {
  background: var(--ui);
  color: var(--ui-text);
  padding: 1.5rem;
  border-radius: 8px;
  border: 1px solid var(--ui-border);
  min-width: 300px;
}
.modal-content h3 { margin-top: 0; }
.modal-content label { display: flex; align-items: center; gap: .5rem; margin: .75rem 0; font-size: 14px; }
.modal-content label.disabled { color: #999; }
.modal-buttons { display: flex; justify-content: flex-end; gap: .5rem; margin-top: 1rem; }