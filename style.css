  :root{
    --page-w: 900;
    --ui:#ffffff; --ui-border:#d0d0d0; --ui-text:#1f1f1f;
    --stage-bg:#ececec; --page-bg:#ffffff;
    --btn-bg:#f4f4f4; --btn-fg:#1f1f1f; --btn-border:#c6c6c6;
    --btn-hover:#ededed; --btn-active:#e6e6e6;
    --ruler-bg: rgba(255,255,255,0.4);
    --ruler-tick: rgba(0,0,0,0.5);
    --tri-color:#666; --tri-red:#b00000;
    --toolbar-h:48px; --tri-h:12px;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --ui:#161616; --ui-border:#2a2a2a; --ui-text:#e8e8e8;
      --stage-bg:#0f0f0f; --page-bg:#111;
      --btn-bg:#2a2a2a; --btn-fg:#e6e6e6; --btn-border:#3a3a3a;
      --ruler-bg: rgba(0,0,0,0.25);
      --ruler-tick: rgba(255,255,255,0.55);
      --tri-color:#bdbdbd; --tri-red:#e06b6b;
    }
  }

@font-face{
  font-family: "TT2020Base";
  src: url("./fonts/TT2020Base-Regular.woff2") format("woff2");
  font-weight: 400; font-style: normal; font-display: swap;
}
@font-face{
  font-family: "TT2020StyleB";
  src: url("./fonts/TT2020StyleB-Regular.woff2") format("woff2");
  font-weight: 400; font-style: normal; font-display: swap;
}
@font-face{
  font-family: "TT2020StyleD";
  src: url("./fonts/TT2020StyleD-Regular.woff2") format("woff2");
  font-weight: 400; font-style: normal; font-display: swap;
}
@font-face{
  font-family: "TT2020StyleE";
  src: url("./fonts/TT2020StyleE-Regular.woff2") format("woff2");
  font-weight: 400; font-style: normal; font-display: swap;
}
@font-face{
  font-family: "TT2020StyleF";
  src: url("./fonts/TT2020StyleF-Regular.woff2") format("woff2");
  font-weight: 400; font-style: normal; font-display: swap;
}
@font-face{
  font-family: "TT2020StyleG";
  src: url("./fonts/TT2020StyleG-Regular.woff2") format("woff2");
  font-weight: 400; font-style: normal; font-display: swap;
}

  html,body{margin:0;height:100%;background:var(--stage-bg);font:16px Courier,"Courier New",monospace;color:var(--ui-text)}

  .toolbar{
    box-sizing:border-box; position:fixed; left:0; right:0; bottom:0; height:var(--toolbar-h);
    z-index:51; display:flex; gap:.5rem; align-items:center;
    padding:.6rem .8rem; background:var(--ui); color:var(--ui-text);
    border-top:1px solid var(--ui-border);
  }
  .btn{
    box-sizing:border-box; border:1px solid var(--btn-border);
    background:var(--btn-bg); color:var(--btn-fg); padding:.2rem .6rem;
    border-radius:6px; cursor:pointer; display:flex; align-items:center; justify-content:center;
    line-height:1.2rem; font-weight:500; min-width:36px; height:30px;
  }
  .btn:hover{ background:var(--btn-hover) } .btn:active{ background:var(--btn-active) }
  .btn[data-active="true"]{ outline:2px solid #8aa2ff; outline-offset:1px }
  .sw{display:inline-block;width:16px;height:16px;border:1px solid rgba(0,0,0,.25);border-radius:3px}
  .sw.black{background:#000} .sw.red{background:#b00000} .sw.white{background:#fff}

  .stage{ height:100vh; overflow:hidden; background:var(--stage-bg); position:relative; }

  .zoom-wrap{ width:100vw; transform-origin: top center; will-change: transform; }
  .stage-inner{
    width:100vw; padding-top:12vh; padding-bottom:calc(12vh + var(--toolbar-h));
    box-sizing:border-box; will-change: transform;
    transform: translate3d(0px,0px,0);
  }
  .page-wrap{ width:calc(var(--page-w) * 1px); margin:0 auto 16px; position:relative; }
  .page{ width:100%; background:var(--page-bg); box-shadow:0 8px 24px rgba(0,0,0,0.10); position:relative; overflow:hidden; }
  .margin-box{ position:absolute; border:1px dashed rgba(0,0,0,0.25); pointer-events:none; visibility:hidden; }
  @media (prefers-color-scheme: dark){
    .margin-box{ border-color: rgba(255,255,255,0.35); }
  }

  .ruler{
    position:fixed; left:0; right:0; bottom:var(--toolbar-h); height:16px; z-index:50;
    display:block; overflow:hidden; pointer-events:none;
  }
  #rulerH_stops_container { position:absolute; inset:0; pointer-events:auto; }
  .ruler-ticks{ position:absolute; inset:0; background:var(--ruler-bg); border-top:1px solid var(--ruler-tick); box-sizing:border-box; }
  .tick{ position:absolute; bottom:0; width:1px; background:var(--ruler-tick); transform:translateZ(0) }
  .tick.major{ height:100% } .tick.medium{ height:60% } .tick.minor{ height:30% }
  .tick-num{ position:absolute; top:0; font-size:9px; line-height:9px; color:var(--ruler-tick); font-family:sans-serif; opacity:0.8 }

  .tri{
    position:absolute; bottom:0; width:0; height:0; cursor:ew-resize;
    border-left:8px solid transparent; border-right:8px solid transparent;
    border-bottom:var(--tri-h) solid var(--tri-color); transform:translateX(-50%);
    filter:drop-shadow(0 0 1px #0004); z-index:2; user-select:none; outline:none;
  }
  .tri.right{border-bottom-color:var(--tri-red)}

  .ruler-v{
    position:fixed; left:0; top:0; bottom:0; width:16px; z-index:50; display:block; overflow:hidden; pointer-events:none;
  }
  #rulerV_stops_container { position:absolute; inset:0; pointer-events:auto; }
  .ruler-v-ticks{ position:absolute; inset:0; background:var(--ruler-bg); border-right:1px solid var(--ruler-tick); box-sizing:border-box; }
  .tick-v{ position:absolute; right:0; height:1px; background:var(--ruler-tick); transform:translateZ(0) }
  .tick-v.major{ width:100% } .tick-v.medium{ width:60% } .tick-v.minor{ width:30% }
  .tick-v-num{ position:absolute; left:2px; font-size:9px; line-height:9px; color:var(--ruler-tick); font-family:sans-serif; opacity:0.8 }

  .tri-v{
    position:absolute; left:0; width:0; height:0; cursor:ns-resize;
    border-top:8px solid transparent; border-bottom:8px solid transparent;
    border-left:var(--tri-h) solid var(--tri-color); transform:translateY(-50%);
    filter:drop-shadow(0 0 1px #0004); z-index:2; user-select:none; outline:none;
  }
  .tri-v.bottom{border-left-color:var(--tri-red)}
  .rulers-off .ruler, .rulers-off .ruler-v{ display:none !important; }

  .guide{ position:fixed; display:none; pointer-events:none; z-index:100; }
  #guideH{ left:0; right:0; height:0; border-top:1px dashed var(--tri-color); }
  #guideV{ top:0; bottom:0; width:0; border-left:1px dashed var(--tri-color); }

  .page canvas{ display:block; width:100%; height:auto; }
  .caret{ position:absolute; width:2px; background:#111; pointer-events:none; animation:blink 1s steps(1) infinite; }
  @keyframes blink { 0%,49%{opacity:1} 50%,100%{opacity:0} }

  dialog.settings-modal[open]::backdrop{ background: rgba(0,0,0,0.35); }
  dialog.settings-modal{
    border:0; padding:0; border-radius:12px; overflow:hidden; width:min(680px, 92vw);
    box-shadow:0 12px 40px rgba(0,0,0,0.25);
  }
  .settings-panel{ background:#fff; color:#222; font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
  @media (prefers-color-scheme: dark){ .settings-panel{ background:#1a1a1a; color:#e6e6e6; } }
  .settings-header{ display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #e6e6e6; }
  @media (prefers-color-scheme: dark){ .settings-header{ border-bottom-color:#2a2a2a; } }
  .settings-body{ display:grid; grid-template-columns: 1fr; gap:16px; padding:16px; }
  .settings-group{ border:1px solid #eee; border-radius:8px; padding:10px; }
  @media (prefers-color-scheme: dark){ .settings-group{ border-color:#2a2a2a; } }
  .font-option{ display:flex; align-items:center; gap:10px; padding:6px 4px; border-radius:6px; }
  .font-sample{ font-size:16px; line-height:1; white-space:nowrap; }
  .mm-grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; }
  .mm-grid label{ font-size:12px; color:#555; }
  .mm-grid input{ width:100%; box-sizing:border-box; padding:6px 8px; border:1px solid #ccc; border-radius:6px; }
  .settings-footer{ padding:12px 16px; border-top:1px solid #e6e6e6; display:flex; justify-content:flex-end; }
  @media (prefers-color-scheme: dark){
    .mm-grid label{ color:#bbb; }
    .mm-grid input{ border-color:#3a3a3a; background:#1f1f1f; color:#eee; }
    .settings-footer{ border-top-color:#2a2a2a; }
  }

  .ctl{ display:flex; align-items:center; gap:6px; padding:0 4px; }
  .ctl label{ font-size:12px; color:#444; }
  .ctl input[type="number"], .ctl select{
    height:30px; box-sizing:border-box;
    border:1px solid var(--btn-border); border-radius:6px; padding:0 6px;
    background:#fff; color:#111; font:12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  }
  .ctl input[type="number"]{ width:84px; }
  .ctl input[type="checkbox"]{ width:16px; height:16px; }
  .ctl select{ width:72px; }
  @media (prefers-color-scheme: dark){
    .ctl label{ color:#ddd; }
    .ctl input[type="number"], .ctl select{ background:#1f1f1f; color:#e6e6e6; border-color:#3a3a3a; }
  }

  .zoom-controls{
    position:fixed;
    right:0px;
    top:16px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
    z-index:52;
  }
  .slider{
    position:relative;
    width:60px;
    height:calc(122px + 2px + 14px);
    pointer-events:none;
  }
  .track{
    position:absolute;
    top:0;
    left:50%;
    transform:translateX(-50%);
    width:4.1px;
    height:122px;
    border:1px solid var(--tri-color);
    border-radius:35px;
    background:transparent;
    overflow:hidden;
    pointer-events:none;
  }
  .fill{
    position:absolute;
    left:0;
    right:0;
    bottom:0;
    height:0;
    background:var(--tri-color);
    pointer-events:none;
    will-change:height;
  }
  .thumb{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    width:13px;
    height:13px;
    border-radius:50%;
    background:var(--tri-color);
    pointer-events:auto;
    touch-action:none;
    cursor:ns-resize;
  }
  .thumb:active{ filter:brightness(0.97); }
  #zoomIndicator{
    background:var(--btn-bg);
    color:var(--btn-fg);
    padding:2px 6px;
    border-radius:4px;
    font-size:12px;
    font-family:sans-serif;
    border:1px solid var(--btn-border);
    opacity:0;
    transition:opacity 0.4s ease-out;
    pointer-events:none;
  }
  #zoomIndicator.show{
    opacity:1;
    transition-duration:0.1s;
  }
